/*! For license information please see main.b39526d5.chunk.js.LICENSE.txt */
(this.webpackJsonpmclient=this.webpackJsonpmclient||[]).push([[0],{24:function(t,e,n){"use strict";var i=n(31),o=n(3),s=n(4),a=n(10),c=n(9),r=n(1),l=(n(2),n(11)),h=n(16),u=n(0);!function(){var t=r.Marker.prototype._initIcon,e=r.Marker.prototype._setPos,n="msTransform"===r.DomUtil.TRANSFORM;r.Marker.addInitHook((function(){var t=this.options.icon&&this.options.icon.options&&this.options.icon.options.iconAnchor;t&&(t=t[0]+"px "+t[1]+"px"),this.options.rotationOrigin=this.options.rotationOrigin||t||"center bottom",this.options.rotationAngle=this.options.rotationAngle||0,this.on("drag",(function(t){t.target._applyRotation()}))})),r.Marker.include({_initIcon:function(){t.call(this)},_setPos:function(t){e.call(this,t),this._applyRotation()},_applyRotation:function(){this.options.rotationAngle&&(this._icon.style[r.DomUtil.TRANSFORM+"Origin"]=this.options.rotationOrigin,n?this._icon.style[r.DomUtil.TRANSFORM]="rotate("+this.options.rotationAngle+"deg)":this._icon.style[r.DomUtil.TRANSFORM]+=" rotateZ("+this.options.rotationAngle+"deg)")},setRotationAngle:function(t){return this.options.rotationAngle=t,this.update(),this},setRotationOrigin:function(t){return this.options.rotationOrigin=t,this.update(),this}})}();var p=function(t){Object(a.a)(n,t);var e=Object(c.a)(n);function n(){return Object(o.a)(this,n),e.apply(this,arguments)}return Object(s.a)(n,[{key:"createLeafletElement",value:function(t){var e=new r.Marker(t.position,this.getOptions(t));return this.contextValue=Object(i.a)(Object(i.a)({},t.leaflet),{},{popupContainer:e}),e}},{key:"updateLeafletElement",value:function(t,e){e.position!==t.position&&this.leafletElement.setLatLng(e.position),e.icon!==t.icon&&this.leafletElement.setIcon(e.icon),e.zIndexOffset!==t.zIndexOffset&&this.leafletElement.setZIndexOffset(e.zIndexOffset),e.opacity!==t.opacity&&this.leafletElement.setOpacity(e.opacity),e.draggable!==t.draggable&&(!0===e.draggable?this.leafletElement.dragging.enable():this.leafletElement.dragging.disable()),e.rotationAngle!==t.rotationAngle&&this.leafletElement.setRotationAngle(e.rotationAngle),e.rotationOrigin!==t.rotationOrigin&&this.leafletElement.setRotationOrigin(e.rotationOrigin)}},{key:"render",value:function(){var t=this.props.children;return null==t||null==this.contextValue?null:Object(u.jsx)(l.a,{value:this.contextValue,children:t})}}]),n}(h.a);e.a=Object(l.b)(p)},45:function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return y}));var i=n(14),o=n.n(i),s=n(21),a=n(3),c=n(4),r=n(10),l=n(9),h=n(2),u=n.n(h),p=n(1),f=n.n(p),b=n(86),j=n(85),g=n(87),d=n(24),O=n(0),m=(f.a.icon({iconUrl:"img/car_above.png",iconSize:[16,32],iconAnchor:[8,16]}),f.a.icon({iconUrl:"img/car_above.png",iconSize:[32,64],iconAnchor:[16,32]})),v=(f.a.icon({iconUrl:"img/car_above.png",iconSize:[64,128],iconAnchor:[32,64]}),f.a.icon({iconUrl:"img/bus_above_active.png",iconSize:[16,32],iconAnchor:[8,16]}),f.a.icon({iconUrl:"img/bus_above_active.png",iconSize:[32,64],iconAnchor:[16,32]})),x=(f.a.icon({iconUrl:"img/bus_above_active.png",iconSize:[64,128],iconAnchor:[32,64]}),f.a.icon({iconUrl:"img/train_above.png",iconSize:[16,32],iconAnchor:[8,16]}),f.a.icon({iconUrl:"img/train_above.png",iconSize:[32,64],iconAnchor:[16,32]})),y=(f.a.icon({iconUrl:"img/train_above.png",iconSize:[64,128],iconAnchor:[32,64]}),function(e){Object(r.a)(i,e);var n=Object(l.a)(i);function i(t){var e;return Object(a.a)(this,i),(e=n.call(this,t)).vehicleIcon=m,e.busIcon=v,e.trainIcon=x,e.mapRef=u.a.createRef(),e}return Object(c.a)(i,[{key:"componentDidMount",value:function(){console.log(this.mapRef)}},{key:"componentWillUnmount",value:function(){}},{key:"componentWillReceiveProps",value:function(t){this.setState(t)}},{key:"isAssignedKeyInToio",value:function(t,e){for(var n=0;n<e.length;++n)if(e[n].packerID==t)return!0;return!1}},{key:"searchToioIndex",value:function(t,e){for(var n=0;n<e.length;++n)if(e[n].packerID==t)return n;return null}},{key:"findVacantToio",value:function(t){for(var e=0;e<t.length;++e)if(null==t[e].packerID)return e;return null}},{key:"convLatLonTOToioCoordinate",value:function(t,e){return[parseInt(-11341.1478*t+398985.4461),parseInt(10947.8571*e-1499948.53106)]}},{key:"convHomotheticRatio",value:function(t,e){var n=t.lng,i=t.lat,o=e.lng;return[915/(e.lat-i),863/(n-o)]}},{key:"convLatLonTOToioCoordinateDynamic",value:function(t,e,n,i,o){var s=492+n[0]*(t-i),a=466.5-n[1]*(e-o);return s<50?s=a<49||a>934?55:50:s>883&&(s=a<49||a>934?878:883),a<49?a=s<50||s>883?54:49:a>934&&(a=s<50||s>883?929:934),[parseInt(a),parseInt(s)]}},{key:"moveToio",value:function(){var e=Object(s.a)(o.a.mark((function e(n,i,s,a){var c,r,l,h,u;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=this.mapRef.current.leafletElement.getCenter(),r=this.mapRef.current.leafletElement.getBounds(),l=this.convHomotheticRatio(r.getNorthWest(),r.getSouthEast()),h=this.convLatLonTOToioCoordinateDynamic(n,i,l,c.lat,c.lng),(u=t.alloc(13)).writeUInt8(3,0),u.writeUInt8(0,1),u.writeUInt8(5,2),u.writeUInt8(2,3),u.writeUInt8(60,4),u.writeUInt8(0,5),u.writeUInt8(0,6),u.writeUInt16LE(h[0],7),u.writeUInt16LE(h[1],9),u.writeUInt16LE(90,11),e.next=17,a.props.characteristics[s].characteristic.writeValue(t.from(u));case 17:case"end":return e.stop()}}),e,this)})));return function(t,n,i,o){return e.apply(this,arguments)}}()},{key:"render",value:function(){var t=[];if(this.props.taxi){var e=0,n=this.props.store.getVehicle(0),i=this.props.characteristics,o=this;Object.keys(n).forEach((function(s){o.isAssignedKeyInToio(s,i)?(console.log("send position info to toio."),o.moveToio(n[s][0][0],n[s][0][1],o.searchToioIndex(s,i),o),t.push(Object(O.jsx)(d.a,{position:[n[s][0][0],n[s][0][1]],icon:m,rotationOrigin:m.options.iconAnchor[0]+"px "+m.options.iconAnchor[1]+"px",rotationAngle:[n[s][0][2]]}))):null!==o.findVacantToio(i)&&(e=o.findVacantToio(i),o.props.characteristics[e].packerID=s,console.log(o.props.characteristics[e].packerID),console.log("toio is assigned"))}))}if(this.props.bus){var s=this.props.store.getVehicle(3);Object.keys(s).forEach((function(e){t.push(Object(O.jsx)(d.a,{position:[s[e][0][0],s[e][0][1]],icon:v,rotationOrigin:v.options.iconAnchor[0]+"px "+v.options.iconAnchor[1]+"px",rotationAngle:[s[e][0][2]]}))}))}if(this.props.busTrace){var a=this.props.store.getVehicle(3);Object.keys(a).forEach((function(e){var n=a[e],i=[];n.forEach((function(t){i.push([t[0],t[1]])})),t.push(Object(O.jsx)(b.a,{positions:i}))}))}if(this.props.train){var c=this.props.store.getVehicle(2);Object.keys(c).forEach((function(e){t.push(Object(O.jsx)(d.a,{position:[c[e][0][0],c[e][0][1]],icon:x,rotationOrigin:x.options.iconAnchor[0]+"px "+x.options.iconAnchor[1]+"px",rotationAngle:[c[e][0][2]]}))}))}var r=Object(O.jsx)("div",{});t.length>0&&(r=t);var l=Object(O.jsxs)(j.a,{center:[34.8594,137.172],zoom:13,bounds:[[35.177343,137.011519],[35.098515,137.095097]],ref:this.mapRef,children:[Object(O.jsx)(g.a,{url:"https://tiles.wmflabs.org/bw-mapnik/{z}/{x}/{y}.png",attribution:'\xa9 <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'}),r]});return console.log(this.mapRef),Object(O.jsx)("section",{className:"content",children:l})}}]),i}(h.Component))}).call(this,n(17).Buffer)},54:function(t,e,n){},81:function(t,e){},84:function(t,e,n){"use strict";n.r(e);var i=n(2),o=n.n(i),s=n(44),a=n.n(s),c=(n(54),n(14)),r=n.n(c),l=n(21),h=n(3),u=n(4),p=n(22),f=n(10),b=n(9),j=n(0),g=function(t){Object(f.a)(n,t);var e=Object(b.a)(n);function n(){return Object(h.a)(this,n),e.apply(this,arguments)}return Object(u.a)(n,[{key:"render",value:function(){return Object(j.jsxs)("header",{className:"main-header",children:[Object(j.jsxs)("a",{href:"",className:"logo",children:[Object(j.jsx)("span",{className:"logo-mini",children:Object(j.jsx)("b",{children:"Map"})}),Object(j.jsxs)("span",{className:"logo-lg",children:[Object(j.jsx)("b",{children:"Map"}),"Provider"]})]}),Object(j.jsx)("nav",{className:"navbar navbar-static-top",children:Object(j.jsx)("a",{href:"",className:"sidebar-toggle","data-toggle":"push-menu",role:"button",children:Object(j.jsx)("span",{className:"sr-only",children:"Toggle navigation"})})})]})}}]),n}(i.Component),d=function(t){Object(f.a)(n,t);var e=Object(b.a)(n);function n(t){return Object(h.a)(this,n),e.call(this,t)}return Object(u.a)(n,[{key:"render",value:function(){var t=this;return Object(j.jsx)("aside",{className:"main-sidebar",children:Object(j.jsxs)("section",{className:"sidebar",children:[Object(j.jsx)("form",{action:"#",method:"get",className:"sidebar-form",children:Object(j.jsxs)("div",{className:"input-group",children:[Object(j.jsx)("input",{type:"text",name:"q",className:"form-control",placeholder:"Filter..."}),Object(j.jsx)("span",{className:"input-group-btn",children:Object(j.jsx)("button",{type:"submit",name:"search",id:"search-btn",className:"btn btn-flat",children:Object(j.jsx)("i",{className:"fa fa-search"})})})]})}),Object(j.jsxs)("ul",{className:"sidebar-menu","data-widget":"tree",children:[Object(j.jsx)("li",{className:"header",children:"Controls"}),Object(j.jsx)("li",{children:Object(j.jsxs)("a",{href:"#",onClick:function(){t.props.resetView()},children:[Object(j.jsx)("i",{className:"fa fa-th"})," ",Object(j.jsx)("span",{children:"Reset View"}),Object(j.jsx)("span",{className:"pull-right-container"})]})}),Object(j.jsx)("li",{children:Object(j.jsxs)("a",{href:"#",onClick:function(){t.props.showBus()},children:[Object(j.jsx)("i",{className:"fa fa-th"})," ",Object(j.jsx)("span",{children:"Show Bus"}),Object(j.jsx)("span",{className:"pull-right-container"})]})}),Object(j.jsx)("li",{children:Object(j.jsxs)("a",{href:"#",onClick:function(){t.props.showBusTrace()},children:[Object(j.jsx)("i",{className:"fa fa-th"})," ",Object(j.jsx)("span",{children:"Show Bus Trace"}),Object(j.jsx)("span",{className:"pull-right-container"})]})}),Object(j.jsx)("li",{children:Object(j.jsxs)("a",{href:"#",onClick:function(){t.props.showTaxi()},children:[Object(j.jsx)("i",{className:"fa fa-th"})," ",Object(j.jsx)("span",{children:"Show Taxi"}),Object(j.jsx)("span",{className:"pull-right-container"})]})}),Object(j.jsx)("li",{children:Object(j.jsxs)("a",{href:"#",onClick:function(){t.props.showTrain()},children:[Object(j.jsx)("i",{className:"fa fa-th"})," ",Object(j.jsx)("span",{children:"Show Train"}),Object(j.jsx)("span",{className:"pull-right-container"})]})}),Object(j.jsx)("li",{children:Object(j.jsxs)("a",{href:"#",onClick:function(){t.props.connectToToio()},children:[Object(j.jsx)("i",{className:"fa fa-th"})," ",Object(j.jsx)("span",{children:"Bluetooth Connection"}),Object(j.jsx)("span",{className:"pull-right-container"})]})})]})]})})}}]),n}(i.Component),O=function(t){Object(f.a)(n,t);var e=Object(b.a)(n);function n(t){var i;return Object(h.a)(this,n),(i=e.call(this,t)).state={component:i.props.component,args:i.props.args},i}return Object(u.a)(n,[{key:"componentDidMount",value:function(){}},{key:"componentWillUnmount",value:function(){}},{key:"componentWillReceiveProps",value:function(t){this.setState(t)}},{key:"render",value:function(){return Object(j.jsx)("div",{className:"content-wrapper",children:o.a.createElement(this.state.component,this.state.args,"")})}}]),n}(i.Component),m=function(){function t(){Object(h.a)(this,t),console.log("New Message Store"),this.clear()}return Object(u.a)(t,[{key:"clear",value:function(){this.bus={},this.taxi={},this.train={},this.busTrace={}}},{key:"addVehicle",value:function(t,e){void 0===t[e.id]&&(t[e.id]=[]),t[e.id].length>1e3&&t[e.id].pop(),t[e.id].unshift([e.lat,e.lon,e.angle,e.speed])}},{key:"addPosition",value:function(t){var e=JSON.parse(t);0==e.mtype?this.addVehicle(this.taxi,e):3==e.mtype?this.addVehicle(this.bus,e):2==e.mtype&&this.addVehicle(this.train,e)}},{key:"getVehicle",value:function(t){return 0===t?this.taxi:3==t?this.bus:2==t?this.train:void 0}}]),t}(),v=n(45),x=n(48),y=n.n(x),k=function(t){Object(f.a)(n,t);var e=Object(b.a)(n);function n(t){var i;Object(h.a)(this,n),(i=e.call(this,t)).characteristics=[];var o=y()();return i.mstore=new m,i.state={characteristics:i.characteristics,store:i.mstore,bus:!0,busTrace:!0,taxi:!0,train:!0},o.on("connect",(function(){console.log("Socket.IO Connected!")})),o.on("event",i.getEvent.bind(Object(p.a)(i))),o.on("disconnect",(function(){console.log("Socket.IO Disconnected!")})),i.selComp=v.a,i.selArg={characteristics:i.state.characteristics,store:i.state.store,bus:i.state.bus,busTrace:i.state.busTrace,taxi:i.state.taxi,train:i.state.train},i}return Object(u.a)(n,[{key:"getEvent",value:function(t){this.mstore.addPosition(t),this.setState({store:this.mstore})}},{key:"resetView",value:function(){this.setState({reset:!0}),this.selArg.reset=!0}},{key:"showBus",value:function(){this.setState({bus:!this.state.bus}),this.selArg.bus=this.state.bus}},{key:"showBusTrace",value:function(){this.setState({busTrace:!this.state.busTrace}),this.selArg.busTrace=this.state.busTrace}},{key:"showTaxi",value:function(){this.setState({taxi:!this.state.taxi}),this.selArg.taxi=this.state.taxi}},{key:"showTrain",value:function(){this.selArg.train=!this.state.train,this.setState({train:this.selArg.train})}},{key:"componentDidMount",value:function(){}},{key:"connectToToio",value:function(){var t=Object(l.a)(r.a.mark((function t(){var e,n,i,o,s,a;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e="10b20100-5b3b-4571-9508-cf3efcd7bbae",n="10b20102-5b3b-4571-9508-cf3efcd7bbae",t.next=4,navigator.bluetooth.requestDevice({filters:[{services:[e]}]});case 4:return i=t.sent,t.next=7,i.gatt.connect();case 7:return o=t.sent,t.next=10,o.getPrimaryService(e);case 10:return s=t.sent,t.next=13,s.getCharacteristic(n);case 13:a=t.sent,this.characteristics.push({characteristic:a,packerID:null}),console.log("connected!");case 16:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"render",value:function(){var t=this,e=Object(j.jsx)(g,{}),n=Object(j.jsx)(d,{clearLogs:function(){return t.clearLogs()},showBus:function(){return t.showBus()},showBusTrace:function(){return t.showBusTrace()},showTaxi:function(){return t.showTaxi()},showTrain:function(){return t.showTrain()},resetView:function(){return t.resetView()},connectToToio:function(){return t.connectToToio()}}),i=Object(j.jsx)(O,{component:this.selComp,args:this.selArg});return Object(j.jsxs)("div",{children:[e,n,i]})}}]),n}(i.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a.a.render(Object(j.jsx)(k,{}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(t){t.unregister()}))}},[[84,1,2]]]);
//# sourceMappingURL=main.b39526d5.chunk.js.map